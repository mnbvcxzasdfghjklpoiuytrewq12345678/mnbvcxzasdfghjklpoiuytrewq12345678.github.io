<!DOCTYPE html>
<html lang="id">
<head>
    <!-- Pengaturan Karakter dan Viewport -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card - PKC PMII Bali Nusra</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="assets/images/favicon.png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Memuat Library jsPDF & autoTable untuk membuat PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>

    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            overflow-x: hidden; 
            background-color: #ffffff;
            scroll-behavior: smooth;
        }
        
        body.is-loading { 
            overflow: hidden; 
        }

        #mobile-menu { 
            max-height: 0; 
            overflow: hidden; 
            transition: max-height 0.5s ease-in-out; 
        }
        #mobile-menu.active { 
            max-height: 500px; 
        }

        .popup-overlay {
            transition: opacity 0.3s ease-in-out;
        }
        .popup-content {
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }

        @keyframes fadeInSlideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .content-animate {
            opacity: 0;
            animation: fadeInSlideUp 0.8s ease-out 0.5s forwards;
        }
    </style>
</head>
<body class="is-loading">

    <!-- Preloader -->
    <div id="preloader" class="fixed inset-0 bg-white z-[100] flex justify-center items-center transition-opacity duration-500">
        <img src="https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExNzF1cjh4azczenl0MGJlMmU2cG5vYjZlbHJ4MWI1ODR1NmZ5YWlvZiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/f2iyEmbEMZT7BRPxyr/giphy.gif" alt="Loading..." class="w-40 h-40">
    </div>

    <!-- Header -->
    <header class="bg-gradient-to-r from-[#0973d6] to-[#2918a9] text-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-6">
            <div class="relative flex items-center justify-center h-20">
                <!-- Navigasi Desktop -->
                <nav class="hidden md:flex items-center">
                    <ul class="flex items-center space-x-8 text-lg">
                        <li><a href="index.html" class="hover:text-[#ffcb05] transition-colors duration-300">Home</a></li>
                        <li><a href="about.html" class="hover:text-[#ffcb05] transition-colors duration-300">About</a></li>
                        <li><a href="team.html" class="hover:text-[#ffcb05] transition-colors duration-300">Team</a></li>
                        <li><a href="release.html" class="hover:text-[#ffcb05] transition-colors duration-300">Release</a></li>
                    </ul>
                </nav>
                <!-- Hamburger -->
                <div class="md:hidden absolute top-1/2 right-0 transform -translate-y-1/2">
                    <button id="hamburger-button" class="text-white focus:outline-none" aria-label="Buka Menu">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                    </button>
                </div>
            </div>
            <!-- Menu Mobile -->
            <nav id="mobile-menu" class="md:hidden">
                <ul class="flex flex-col items-center space-y-4 py-6 text-lg">
                    <li><a href="index.html" class="hover:text-[#ffcb05] transition-colors duration-300">Home</a></li>
                    <li><a href="about.html" class="hover:text-[#ffcb05] transition-colors duration-300">About</a></li>
                    <li><a href="team.html" class="hover:text-[#ffcb05] transition-colors duration-300">Team</a></li>
                    <li><a href="release.html" class="hover:text-[#ffcb05] transition-colors duration-300">Release</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Konten -->
    <main>
        <!-- Formulir -->
        <section id="form-section" class="py-12 md:py-20">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="max-w-3xl mx-auto content-animate">
                    <div class="text-center mb-10">
                        <!-- Judul -->
                        <h1 class="text-lg font-bold text-black">KARTU PERGERAKAN</h1>
                    </div>

                    <!-- Formulir -->
                    <div class="bg-white p-6 sm:p-8 rounded-2xl">
                        <form id="kta-form" class="space-y-6">
                            <!-- Input -->
                            <div>
                                <label for="nama_lengkap" class="block text-sm font-medium text-black">Nama Lengkap</label>
                                <input type="text" id="nama_lengkap" name="nama_lengkap" required class="mt-1 block w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0973d6] focus:border-transparent transition">
                            </div>
                            <div>
                                <label for="email" class="block text-sm font-medium text-black">Alamat Email</label>
                                <input type="email" id="email" name="email" required class="mt-1 block w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0973d6] focus:border-transparent transition">
                            </div>
                            <div>
                                <label for="telepon" class="block text-sm font-medium text-black">Nomor Telepon</label>
                                <input type="number" id="telepon" name="telepon" required class="mt-1 block w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0973d6] focus:border-transparent transition">
                            </div>
                            <div>
                                <label for="asal_rayon" class="block text-sm font-medium text-black">Rayon/Fakultas</label>
                                <input type="text" id="asal_rayon" name="asal_rayon" required class="mt-1 block w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0973d6] focus:border-transparent transition">
                            </div>
                            <div>
                                <label for="asal_komisariat" class="block text-sm font-medium text-black">Komisariat/Kampus</label>
                                <input type="text" id="asal_komisariat" name="asal_komisariat" required class="mt-1 block w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0973d6] focus:border-transparent transition">
                            </div>
                            <div>
                                <label for="asal_cabang" class="block text-sm font-medium text-black">Cabang/(Kabupaten/Kota)</label>
                                <input type="text" id="asal_cabang" name="asal_cabang" required class="mt-1 block w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0973d6] focus:border-transparent transition">
                            </div>
                            <div>
                                <label for="sertifikat_mapaba" class="block text-sm font-medium text-black">Sertifikat MAPABA</label>
                                <input type="file" id="sertifikat_mapaba" name="sertifikat_mapaba" accept="image/*" required class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2.5 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 cursor-pointer">
                            </div>
                            <div>
                                <label for="foto_jas" class="block text-sm font-medium text-black">Foto dengan Jas PMII</label>
                                <input type="file" id="foto_jas" name="foto_jas" accept="image/*" required class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2.5 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 cursor-pointer">
                            </div>
                            <div class="pt-4">
                                <!-- Tombol -->
                                <button type="submit" id="submit-button" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-base font-medium text-white bg-[#0973d6] hover:bg-[#ffcb05] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-300 active:scale-95">
                                    Buat KTA PMII
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gradient-to-r from-[#0973d6] to-[#2918a9] text-white pt-12">
        <div class="container mx-auto px-6">
            <div class="flex flex-col md:flex-row justify-center items-start gap-y-10 md:gap-x-[10%]">
                <div class="w-full md:w-[40%]">
                    <h3 class="text-lg font-bold text-[#ffcb05] mb-4">Media Sosial</h3>
                    <ul class="space-y-4 text-sm">
                        <li class="flex items-center gap-4"><div class="bg-white bg-opacity-20 w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878V14.89h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v7.028C18.343 21.128 22 16.991 22 12Z"/></svg></div><span>PKC PMII Bali Nusra</span></li>
                        <li class="flex items-center gap-4"><div class="bg-white bg-opacity-20 w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M12 2c-2.717 0-3.056.01-4.122.06-1.065.05-1.79.217-2.428.465a4.898 4.898 0 0 0-1.772 1.153A4.898 4.898 0 0 0 2.52 5.454c-.248.638-.415 1.363-.465 2.428C2.01 8.944 2 9.283 2 12s.01 3.056.06 4.122c.05 1.065.217 1.79.465 2.428a4.898 4.898 0 0 0 1.153 1.772A4.898 4.898 0 0 0 5.454 21.48c.638.248 1.363.415 2.428.465C8.944 21.99 9.283 22 12 22s3.056-.01 4.122-.06c1.065-.05 1.79-.217-2.428-.465a4.898 4.898 0 0 0 1.772-1.153A4.898 4.898 0 0 0 21.48 18.546c.248-.638.415-1.363.465-2.428.05-1.066.06-1.405.06-4.122s-.01-3.056-.06-4.122c-.05-1.065-.217-1.79-.465-2.428a4.898 4.898 0 0 0-1.153-1.772A4.898 4.898 0 0 0 18.546 2.52c-.638-.248-1.363-.415-2.428-.465C15.056 2.01 14.717 2 12 2Zm0 2c2.67 0 2.987.01 4.042.059.975.044 1.502.207 1.857.344.467.182.8.399 1.15.748.35.35.566.683.748 1.15.137.355.3.882.344 1.857.048 1.055.058 1.372.058 4.042s-.01 2.987-.058 4.042c-.044.975-.207 1.502-.344 1.857a3.19 3.19 0 0 1-.748 1.15 3.19 3.19 0 0 1-1.15.748c-.355.137-.882.3-1.857.344-1.055.048-1.372.058-4.042.058s-2.987-.01-4.042-.058c-.975-.044-1.502-.207-1.857-.344a3.19 3.19 0 0 1-1.15-.748 3.19 3.19 0 0 1-.748-1.15c-.137-.355-.3-.882-.344-1.857C4.01 15.013 4 14.697 4 12s.01-2.987.058-4.042c.044-.975.207-1.502.344-1.857.182-.466.399-.8.748-1.15.35-.35.683-.566 1.15-.748.355-.137.882-.3 1.857-.344C9.013 4.01 9.33 4 12 4Zm0 5a3 3 0 1 0 0 6 3 3 0 0 0 0-6Zm0-2a5 5 0 1 1 0 10 5 5 0 0 1 0-10Zm6.5-2.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Z" clip-rule="evenodd"/></svg></div><span>@pkc.pmiibalinusra</span></li>
                        <li class="flex items-center gap-4"><div class="bg-white bg-opacity-20 w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M19.802 7.027a2.5 2.5 0 0 0-1.76-1.768C16.532 5 12 5 12 5s-4.532 0-6.042.259a2.5 2.5 0 0 0-1.76 1.768C4 8.536 4 12 4 12s0 3.464.2 4.973a2.5 2.5 0 0 0 1.76 1.768C7.468 19 12 19 12 19s4.532 0 6.042-.259a2.5 2.5 0 0 0 1.76-1.768C20 15.464 20 12 20 12s0-3.464-.198-4.973ZM9.546 14.582V9.418L14.83 12l-5.284 2.582Z" clip-rule="evenodd"/></svg></div><span>PKC PMII Bali-Nusra</span></li>
                        <li class="flex items-center gap-4"><div class="bg-white bg-opacity-20 w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10s10-4.48 10-10S17.52 2 12 2zm6.28 13.9c-1.63 2.66-4.58 4.35-7.86 4.35c-1.9 0-3.67-.61-5.07-1.68l8.36-8.36c1.11 1.44 1.74 3.25 1.57 5.09zM5.8 9.54c.9 2.22 2.84 3.93 5.25 4.54l-6.2-6.2c-1.05 1.2-1.74 2.76-1.74 4.46c0 .55.07 1.09.2 1.6zM12 3.5c1.88 0 3.63.79 4.89 2.05l-9.43 9.43C6.23 13.75 5.5 12 5.5 10.04c0-2.38 1.5-4.48 3.63-5.59C10.05 3.81 10.99 3.5 12 3.5z"/></svg></div><span>pmiibalinusra.or.id</span></li>
                    </ul>
                </div>
                <div class="w-full md:w-[40%] md:pl-10">
                    <h3 class="text-lg font-bold text-[#ffcb05] mb-4">Alamat</h3>
                    <ul class="space-y-4 text-sm">
                        <li class="flex items-start gap-4"><div class="bg-white bg-opacity-20 w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg></div><span>pkcbalinusra@gmail.com</span></li>
                        <li class="flex items-start gap-4"><div class="bg-white bg-opacity-20 w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg></div><span>+62 877-5432-2362</span></li>
                        <li class="flex items-start gap-4"><div class="bg-white bg-opacity-20 w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></div><span class="flex-1">Jl. Catur Warga No. 9A, Kelurahan Pejanggik, Kecamatan Mataram Timur, Kota Mataram, Provinsi Nusa Tenggara Barat, Indonesia (83127)</span></li>
                    </ul>
                </div>
            </div>
            <div class="text-center text-xs text-white border-t border-white border-opacity-30 mt-10 py-6">
                <p>&copy; 2025 - 2027 PKC PMII Bali Nusra</p>
            </div>
        </div>
    </footer>

    <!-- Pop-up Modal Konfirmasi -->
    <div id="popup-modal" class="popup-overlay fixed inset-0 bg-gray-900 bg-opacity-60 flex justify-center items-center z-[99] hidden opacity-0">
        <div class="popup-content bg-white p-6 sm:p-8 rounded-xl shadow-2xl w-11/12 max-w-md text-center transform scale-95 opacity-0">
            <!-- Teks Pop-up -->
            <h3 class="text-xl font-bold text-[#2918a9] mb-3">Selamat!</h3>
            <p class="text-black mb-6 text-sm">
                Formulir berhasil dibuat, silahkan unduh Formulir KTA PMII terlebih dahulu dengan klik tombol Unduh Formulir. Selanjutnya kirim formulir yang sudah di unduh ke email pmiibalinusra@gmail.com, dengan klik tombol Kirim Email.
            </p>
            <div class="flex flex-col space-y-3">
                <!-- Tombol Pop-up -->
                <button id="modal-download-pdf" class="w-full py-3 px-4 bg-[#ffcb05] text-white rounded-lg hover:bg-[#0973d6] transition-all font-semibold shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#ffcb05]">Unduh Formulir</button>
                <button id="modal-send-email" class="w-full py-3 px-4 bg-[#0973d6] text-white rounded-lg hover:bg-[#ffcb05] transition-all font-semibold shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#0973d6]">Kirim Email</button>
            </div>
            <button id="modal-close" class="mt-6 text-sm font-bold text-[#2918a9] hover:text-[#0973d6] transition-colors">Tutup</button>
        </div>
    </div>

    <!-- Skrip JavaScript -->
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // Alias untuk library jsPDF
        window.jsPDF = window.jspdf.jsPDF;

        // --- Variabel Global ---
        let generatedPdfDoc = null;
        let mailtoLink = '';
        let pdfFilename = 'formulir-kta.pdf';

        // --- Seleksi Elemen DOM ---
        const preloader = document.getElementById('preloader');
        const hamburgerButton = document.getElementById('hamburger-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const ktaForm = document.getElementById('kta-form');
        const submitButton = document.getElementById('submit-button');
        const popupModal = document.getElementById('popup-modal');
        const modalContent = popupModal.querySelector('.popup-content');
        const modalDownloadBtn = document.getElementById('modal-download-pdf');
        const modalSendEmailBtn = document.getElementById('modal-send-email');
        const modalCloseBtn = document.getElementById('modal-close');
        
        // --- Logika Preloader ---
        const hidePreloader = () => {
            if (preloader) {
                preloader.style.opacity = '0';
                preloader.addEventListener('transitionend', () => preloader.style.display = 'none');
                document.body.classList.remove('is-loading');
            } else {
                document.body.classList.remove('is-loading');
            }
        };
        setTimeout(hidePreloader, 3000);

        // --- Logika Hamburger Menu ---
        if (hamburgerButton && mobileMenu) {
            hamburgerButton.addEventListener('click', () => mobileMenu.classList.toggle('active'));
        }

        // --- Fungsi Helper ---
        const readFileAsDataURL = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = (error) => reject(error);
                reader.readAsDataURL(file);
            });
        };

        const openModal = () => {
            popupModal.classList.remove('hidden');
            setTimeout(() => {
                popupModal.classList.remove('opacity-0');
                modalContent.classList.remove('scale-95', 'opacity-0');
            }, 10);
        };

        const closeModal = () => {
            modalContent.classList.add('scale-95', 'opacity-0');
            popupModal.classList.add('opacity-0');
            setTimeout(() => {
                popupModal.classList.add('hidden');
                ktaForm.reset();
            }, 300);
        };

        // --- Logika Utama Saat Formulir Dikirim ---
        const handleFormSubmit = async (event) => {
            event.preventDefault();
            
            submitButton.disabled = true;
            submitButton.textContent = 'Memproses...';

            const uploadedImages = {};
            const tableData = [];
            const dataLabels = {
                'nama_lengkap': 'Nama Lengkap', 'email': 'Alamat Email', 'telepon': 'Nomor Telepon',
                'asal_rayon': 'Asal Rayon', 'asal_komisariat': 'Asal Komisariat', 'asal_cabang': 'Asal Cabang'
            };
            
            for (const element of ktaForm.elements) {
                if (!element.name) continue;

                if (element.type === 'file' && element.files && element.files[0]) {
                    try {
                        uploadedImages[element.name] = await readFileAsDataURL(element.files[0]);
                    } catch (error) {
                        alert("Gagal membaca file. Silakan coba lagi.");
                        submitButton.disabled = false;
                        submitButton.textContent = 'Buat KTA PMII';
                        return;
                    }
                } else if (dataLabels[element.name]) {
                    tableData.push([dataLabels[element.name], element.value || 'Tidak diisi']);
                }
            }
            
            // --- Proses Pembuatan PDF ---
            const doc = new jsPDF();
            doc.setFontSize(18);
            doc.text('Formulir KTA PMII', doc.internal.pageSize.getWidth() / 2, 20, { align: 'center' });
            
            doc.autoTable({
                body: tableData,
                startY: 25,
                theme: 'grid',
                showHead: 'never', 
                styles: { fontSize: 11, cellPadding: 3 },
                columnStyles: {
                    0: { fontStyle: 'bold', cellWidth: 50 },
                    1: { cellWidth: 'auto' }
                }
            });

            // --- Logika Penempatan Gambar Berurutan ---
            const lastTableY = doc.autoTable.previous.finalY;
            const margin = 15;
            let currentY = lastTableY + 15; // Posisi Y awal setelah tabel

            if (uploadedImages.sertifikat_mapaba) {
                const certWidth = 80; // Rasio 4
                const certHeight = 60; // Rasio 3
                doc.text("", margin, currentY);
                currentY += 5; // Spasi untuk teks
                doc.addImage(uploadedImages.sertifikat_mapaba, 'JPEG', margin, currentY, certWidth, certHeight);
                currentY += certHeight + 10; // Perbarui posisi Y untuk gambar berikutnya
            }

            if (uploadedImages.foto_jas) {
                const photoWidth = 60;  // Rasio 3
                const photoHeight = 80; // Rasio 4
                doc.text("", margin, currentY);
                currentY += 5; // Spasi untuk teks
                doc.addImage(uploadedImages.foto_jas, 'JPEG', margin, currentY, photoWidth, photoHeight);
            }

            generatedPdfDoc = doc;
            
            const pendaftarName = document.getElementById('nama_lengkap').value.trim() || 'Pendaftar';
            pdfFilename = `formulir-kta-${pendaftarName.replace(/\s+/g, '_')}.pdf`;

            const recipientEmail = "pmiibalinusra@gmail.com";
            const subject = encodeURIComponent(`Buat KTA PMII - ${pendaftarName}`);
            const body = encodeURIComponent(`Yth. PKC PMII Bali Nusra,\n\nBerikut saya lampirkan formulir pendaftaran KTA atas nama ${pendaftarName}.\n\nMohon untuk diproses lebih lanjut.\n\nTerima kasih.\n\nSalam Pergerakan!`);
            mailtoLink = `mailto:${recipientEmail}?subject=${subject}&body=${body}`;

            submitButton.disabled = false;
            submitButton.textContent = 'Buat KTA PMII';
            openModal();
        };
        
        // --- Menambahkan Event Listener ---
        ktaForm.addEventListener('submit', handleFormSubmit);

        modalDownloadBtn.addEventListener('click', () => {
            if (generatedPdfDoc) generatedPdfDoc.save(pdfFilename);
        });

        modalSendEmailBtn.addEventListener('click', () => {
            if (mailtoLink) {
                // The alert is changed to a custom, non-blocking notification if possible
                // For simplicity, we keep it, but in a real app, a toast/snackbar is better.
                // Note: The original alert might not work in sandboxed environments.
                console.log('Silakan lampirkan file PDF yang telah diunduh pada jendela email yang akan terbuka.');
                window.location.href = mailtoLink;
            }
        });
        
        modalCloseBtn.addEventListener('click', closeModal);
        popupModal.addEventListener('click', (e) => {
            if (e.target === popupModal) closeModal();
        });
    });
    </script>
</body>
</html>
